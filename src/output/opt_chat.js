let chatVar={waitMsg:["잠시만 기다려주세요, 답변을 찾고 있습니다!","반갑습니다! 곧 답변을 드리겠습니다.","고민해보고 있습니다. 조금만 기다려주세요!","조금만 기다려주세요, 최선의 답변을 찾고 있습니다.","고민 중입니다. 곧 답변을 드리겠습니다."],rcmdtn_data_type:["str","java","js"],isFirst:!0,isAnswering:!1,chatXhr:null,srch_mng_grp_sn:-1,lastQid:-1,lastQuery:!1,lastTokens:[]},session_userid="";function chatInit(e){e&&(chatVar.srch_mng_grp_sn=e);var s=$("#query").val();-1==chatVar.srch_mng_grp_sn&&chatVar.isFirst?null!=s&&""!==s&&sendMsg():(console.log("기존 채팅방 로드"+e),selectChatHistory(e)),chatVar.isFirst=!1}function chatClearBtn(){Swal.fire({title:"채팅 내역을 삭제하시겠습니까?",text:"삭제된 내역은 다시 되돌릴수 없습니다.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"삭제",cancelButtonText:"취소"}).then(e=>{e.isConfirmed&&clearChat()})}function clearChat(){document.getElementById("query").value="",initChatVar(),$(".chatListUl").html(""),Swal.fire("삭제되었습니다.","","success")}function newChat(){$("#chatTab #chat-room #chatList").html(""),$("#menuOpen").css("display","block"),$("#sysControlShow").css("display","none"),$("#intro").css("display","block"),$("#chatTab").css("display","none"),$(".chatListDiv li").removeClass("b-link--click"),initChatVar()}function initChatVar(){serverResponseCnt=0,chatVar?.chatXhr&&(console.error("답변을 취소합니다."),chatVar.chatXhr.abort(),chatVar.chatXhr=null),chatVar={waitMsg:["잠시만 기다려주세요, 답변을 찾고 있습니다!","반갑습니다! 곧 답변을 드리겠습니다.","고민해보고 있습니다. 조금만 기다려주세요!","조금만 기다려주세요, 최선의 답변을 찾고 있습니다.","고민 중입니다. 곧 답변을 드리겠습니다."],rcmdtn_data_type:["str","java","js"],isFirst:!0,isAnswering:!1,chatXhr:null,srch_mng_grp_sn:-1,lastQid:-1,lastQuery:!1,lastTokens:[]}}function firstAction(){$("#menuOpen").css("display","block"),$("#sysControlShow").css("display","none"),$("#intro").css("display","none"),$("#chatTab").css("display","block"),chatVar.isFirst=!1}function getChatHistory(e){$("#chatTab #chat-room #chatList").html(""),$("#menuOpen").css("display","block"),$("#sysControlShow").css("display","none"),$("#intro").css("display","none"),$("#chatTab").css("display","block"),$(".chatListDiv li").removeClass("b-link--click"),$("#chatRoom"+e).addClass("b-link--click"),chatVar.isFirst=!1,selectChatHistory(chatVar.srch_mng_grp_sn=e)}function sendMsg_v2(e){var{msg:e,paramObject:s,qId:r}=e,e=e||$("#query").val();chatVar.chatXhr=$.ajax({type:"POST",url:"./chat_v2.do",data:{qId:r||null,query:e,lastQid:chatVar.lastQid,lastTokens:chatVar.lastTokens,lastQuery:chatVar.lastQuery,paramObject:JSON.stringify(s)},success:function(e){e=e.fnList;console.log("추출 함수 리스트",e)},error:function(e){console.error(e)}})}function sendMsg(e,s,r){if(s=s||{},$("#query").attr("placeholder",""),chatVar.isAnswering)return toastr.info("답변중에는 채팅을 할 수 없습니다."),!1;let d=e||$("#query").val();if(!d)return toastr.info("메시지를 입력해주세요"),!1;chatVar.isFirst&&firstAction(),openTab("/common/home",0,"AI CHAT","AI CHAT"),chat({msgFrom:"client",msg:d}),$("input[name='query']").val(""),chat({msgFrom:"server_wait",msg:chatVar.waitMsg[Math.floor(Math.random()*chatVar.waitMsg.length)]});let h=getDateParameter(d);s.searchDate=h,chatVar.isAnswering=!0,chatVar.chatXhr=$.ajax({type:"POST",url:"./chat_v2.do",data:{qId:r||null,srch_mng_grp_sn:chatVar.srch_mng_grp_sn,query:d,lastQid:chatVar.lastQid,lastTokens:chatVar.lastTokens,lastQuery:chatVar.lastQuery,paramObject:JSON.stringify(s)},success:function(e){var s=e.paramObject,r=e.chat_result,{qId:e,query:t,answer:n,score:a,rcmdtn_type:o,tokens:c,rcmdtn_data_type:l,srch_mng_grp_sn:i,functions:u}=(r.params=e.params,r),p=domain_context;chatVar.srch_mng_grp_sn=i,$(".chatListDiv li").removeClass("b-link--click"),$("#chatRoom"+i).addClass("b-link--click"),e?(chatVar.lastQid=e,chatVar.lastTokens=c.join("@"),chatVar.lastQuery=t,console.log(`id:${e} , type:${o} , query:${t} , type:${chatVar.rcmdtn_data_type[l]}, answer:${n} , score:`+a)):(chatVar.lastQid=-1,chatVar.lastTokens="",chatVar.lastQuery=d,console.log(`history dive clear | id:${e} , type:${o} , query:${t} , type:${chatVar.rcmdtn_data_type[l]}, answer:${n} , score:`+a)),r.query=d,r.searchDate=h,r.domainParam=p,chat_response(r,s,u)},error:function(e){console.error(e)}})}function executeFn(e){if(chatVar.isAnswering)toastr.info("답변중에는 채팅을 할 수 없습니다.");else{const{fnName:t,qId:r,qstn:n}=e;e.fnChat=!0,"function"==typeof window[t]?sendMsg(n):(console.log(r,n),$.ajax({type:"POST",url:"./chat/"+t,async:!1,data:{qId:r,query:n},success:async function(e){chat({msgFrom:"client",msg:n}),console.log(e);var e=e.msg||"no answer",s=await getFunctions(r,n);chatVar.isAnswering=!0,chat({msgFrom:"server",msg:e.replaceAll("\n","<br>"),fnChat:!0,btns:s})},error:function(e,s,r){console.error(t,"함수가 선언되지 않아 실행 불가");url;404===e.status?(console.error("Controller not found"),chat({msgFrom:"err",msg:"Controller not found",changeFlag:!0})):(console.error("Unexpected error occurred:",r),chat({msgFrom:"err",msg:"에러발생",changeFlag:!0}))}}))}}function chat_response(e,s,r){console.log("chat_response","param",s),console.log("chat_response","functions",r);var t=e.searchDate;const{rcmdtn_data_type:n,query:a,answer:o,params:c,domainParam:l}=e;var i=chatVar.rcmdtn_data_type[n]||"str",u=getDomainParamList(c),p=c?.searchDate_v2||null;if((console.log("쿼리 상 도메인",u),console.log("searchDate_v2",p),u)&&checkDomain(u))return console.log("도메인이 다릅니다."),chat({msgFrom:"server",msg:`
            현재 선택된 도메인은 [ <span class='fBold'> ${domain_context.getDomainNm()} </span>] 입니다. <br>
            MBUSTER MANAGER는 현재 선택된 도메인 기준으로 데이터를 조회합니다.<br>
            <br>
            [<span class='fBold'>${u.dmn_nm_list[0]}</span>] 도메인과 관련된 조회를 원하시면 <br> 
            상단의 도메인 선택영역에서 도메인을 변경해주세요
        `});p&&(u=JSON.parse(p),t.search_from=u.search_from.date,t.search_to=u.search_to.date),console.log(t);let d=[];$.ajax({type:"POST",url:"./getRelateChat",async:!1,data:{qId:parseInt(e.qId||0)},success:function(e){const s=o;let r=e.list||[];const t=r.find(e=>e.answer==s);t&&(t.sameFn=!0,r=[t,...r.filter(e=>e!==t)]),d=r},error:function(e,s,r){console.error(r)}});let h="",m=[o],g=[a];for(var f in d){const{qId:A,query:a,answer:o,keyword:q,sameFn:F}=d[f];console.log(d[f]);f=`<button class="button-ai button-combine ${F?"sameFn":""}" fnQ="${a}" fnName="${o}" onclick="sendMsg('${a}',null,${A})">${q||a}</button> `;h+=f,m.push(o),g.push(a)}h+=0<d.length?"<br>":"",m=[...new Set(m)],g=[...new Set(g)];if(r){console.log(o);var y,v,_=[];for(y in r){const V=r[y].split("@");var b,w,C={fnName:V[0],qId:V[1],query:V[2],qstn:V[2],required_param:V[3],keyword:V[4]};m.includes(V[0])||g.includes(V[2])||d.find(e=>e.qId==V[1])||(m.push(V[0]),g.push(V[2]),b=`<button class="button-ai button-combine" fnQ="${C.qstn}" fnName="${V[0]}" onclick='executeFn(${JSON.stringify(C)})'>${C.keyword||C.qstn}</button> `,(w={})[C.qstn]=b,_.push(w))}for(v in _.sort(function(e,s){e=Object.keys(e)[0],s=Object.keys(s)[0];return e.localeCompare(s)}),_){var x=Object.values(_[v])[0];h+=x}}switch(i.toUpperCase()){case"STR":var R=o&&"-"!=o?o:noAnswer(a);console.log("연관질문",d),console.log("추출함수",r),chat({msgFrom:"server",msg:R,btns:h});break;case"JAVA":var k,T=(o||"catchAll").split(",");for(k in T)chatJavaFuncExec({lazyload:!0,url:T[k],qId:e.qId,query:a,paramObject:s,btns:h,relateQstn_list:d,fnList:r});break;case"JS":chatJsFuncExec({lazyload:!0,answer:o,qId:e.qId,query:a,params:c,btns:h,searchDate:t,domainParam:l})}}function checkDomain(e){var s=domain_context;const r=e["dmn_sn_list"];if(!r||r.length<1)return!1;let t=!1;return s.dmn_sn_list.forEach(e=>{t=!r.includes(e)}),t}function chatJavaFuncExec(e){const{lazyload:s=!1,url:t,qId:r,query:n,paramObject:a,btns:o,relateQstn_list:c,fnList:l}=e;$.ajax({type:"POST",url:"./chat/"+t,async:!1,data:{qId:r,query:n,paramObject:a},success:function(e){console.log(e);e=e.msg||"no answer";console.log("연관질문",c),console.log("추출함수",l),chat({lazyload:s,msgFrom:"server",msg:e.replaceAll("\n","<br>"),btns:o,changeFlag:!0})},error:function(e,s,r){t;404===e.status?(console.error("Controller not found"),catchAll(chatData,n)):(console.error("Unexpected error occurred:",r),chat({msgFrom:"err",msg:"에러발생",changeFlag:!0}))}})}function catchAll(e,s){$.ajax({type:"POST",url:"./chat/catchAll",async:!1,data:{qId:e.qId,query:s,answer:e.answer,params:e?.params},success:function(e){chat({msgFrom:"err",msg:(e.msg||"no answer").replaceAll("\n","<br>"),changeFlag:!0})},error:function(e){console.error("Unexpected error occurred: "+e);chat({msgFrom:"err",msg:"에러발생",changeFlag:!0})}})}function noAnswer(e){e=[`안타깝게도, 현재 제가 가지고 있는 정보에는<br>"${e}"라는 용어에 대한 답변이 없습니다.<br>하지만 더 많은 정보를 수집하고 분석하여 더 나은 답변을 제공할 수 있도록 노력하겠습니다.`,`"${e}"에 대한 답변을 제공해드리지 못해 죄송합니다.<br>하지만, 더 나은 답변을 찾기 위해 노력할 것이며,<br>필요하신 정보가 있다면 최대한 도움을 드릴 수 있도록 노력하겠습니다.<br><br>다른 궁금하신 사항 있으시면 질문해주시기 바랍니다.`,`죄송합니다, 제 데이터 셋에는 "${e}"라는 용어가 포함되어 있지 않아서,<br>해당 질문에 대한 정확한 답변을 제공하기 어렵습니다. 하지만 더 나은 답변을 찾기 위해 노력하겠습니다.<br>이에 대해 불편을 드려 대단히 죄송합니다.<br>만약 다른 궁금한 점이 있으시다면 언제든지 질문해주시기 바랍니다.`];return e[Math.floor(Math.random()*e.length)]+`<br><br>또는 추천 검색어를 확인하여 도움을 받으 실 수 있습니다.<br><button class="button-ai" onclick="sendMsg('추천검색어를 알려줘')">추천검색어를 알려줘</button>`}function chatJsFuncExec(e){chatVar.isAnswering=!0;const{lazyload:s=!1,answer:r,query:t,params:n,btns:a,searchDate:o,domainParam:c}=e;console.log("jsRes",n);e=getSelectFilter(n);console.log("select Filter",e);try{s&&chat({msgFrom:"server-wait",msg:""}),setTimeout(()=>{"function"==typeof window[r]?window[r]({btns:a,params:n,domainParam:c,searchDate:o,query:t}):console.error("chatJsFuncExec",r+" 함수가 존재하지 않습니다.")},100)}catch(e){chat("err",e,!0)}}$(function(){$("#srch_mng_grp_sn").val();session_userid=$("#session_userid").val()});let serverResponseCnt=0;function chat(e){const{msgFrom:s,msg:r,appendFlag:t,changeFlag:n,btns:a,fnChat:o,originChatParam:c}=e;let l=serverResponseCnt,i,u;switch(s){case"excel":chatVar.isAnswering=!0,serverResponseCnt++,$(".chatListUl").append(`
                <li class="severAnswer"> <b> <img src="/resource/mbuster/codingsepo/images/mbusterLogo/logo_chat_icon.png" alt="MBUSTER"></b>
                         <div style="display:flex; justify-content: space-between;">
                            <p class="server_wait" id="s.erverResponse${serverResponseCnt}"></p>
                            <button class="gen_btn" id="gen_btn_${serverResponseCnt}" onclick="stopChat(this)" style="margin-top: auto; margin-bottom: 0;"><i class="fa-regular fa-circle-stop"></i> 대화 중단</button>
                        </div>
                </li>
                `),i=r.split("<script>"),showMsg=i[0],new Typewriter("#serverResponse"+serverResponseCnt,{delay:55,onComplete:()=>{alert("끝!")}}).typeString(showMsg).pauseFor(50).start().callFunction(()=>{console.log("종료"),$(`#serverResponse${serverResponseCnt} .Typewriter__cursor`).remove(),chatVar.isAnswering=!1,$("#gen_btn_"+serverResponseCnt).remove()}),u="<script>"+i[1],console.log(u),$("#serverResponse"+serverResponseCnt).append(u);break;case"err":return void chatErr(r,n);case"client":$(".chatListUl").append(`
        <li class="response"><b><img src="/resource/mbuster/codingsepo/images/user.gif" alt="프로필사진"></b>
        <p>${r}</p>
        </li>
        `);break;case"server_wait":chatVar.isAnswering=!0,serverResponseCnt++,$(".chatListUl").append(`
        <li class="severAnswer"> <b> <img src="/resource/mbuster/codingsepo/images/mbusterLogo/logo_chat_icon.png" alt="MBUSTER"></b>
                 <div style="display:flex; justify-content: space-between;">
                    <p class="server_wait" id="serverResponse${serverResponseCnt}"></p>
                    <button class="gen_btn" id="gen_btn_${serverResponseCnt}" onclick="stopChat(this)" style="margin-top: auto; margin-bottom: 0;"><i class="fa-regular fa-circle-stop"></i> 대화 중단</button>
                </div>
        </li>
        `),$(document).scrollTo("#serverResponse"+serverResponseCnt,{duration:1e3}),showMsg=r,new Typewriter("#serverResponse"+serverResponseCnt,{delay:55}).typeString(showMsg).pauseFor(50).start();break;case"server":if(chatVar.isAnswering=!0,$(`#serverResponse${serverResponseCnt}.server_wait`)[0]){if(o?(serverResponseCnt++,$(".chatListUl").append(`
                        <li class="severAnswer"><b><img src="/resource/mbuster/codingsepo/images/mbusterLogo/logo_chat_icon.png" alt="MBUSTER"></b>
                          <div style="display:flex; justify-content: space-between;">
                            <p id="serverResponse${serverResponseCnt}"></p>
                            <button class="gen_btn" id="gen_btn_${serverResponseCnt}" onclick="stopChat(this)" style="margin-top: auto; margin-bottom: 0;"><i class="fa-regular fa-circle-stop"></i> 대화 중단</button>
                            </div>
                        </li>
                        `),$(document).scrollTo("#serverResponse"+serverResponseCnt,{duration:1e3})):new Typewriter("#serverResponse"+serverResponseCnt,{delay:55}).deleteAll(),t)return new Promise((e,s)=>{"start"==t.status?(console.log(r),l=serverResponseCnt,i=r.split("<script>"),showMsg=i[0],chatVar.isAnswering=!0,new Typewriter("#serverResponse"+l,{delay:55}).typeString(r).pauseFor(50).start().callFunction(()=>{console.log("prepend 종료",l),$(`#serverResponse${l} .Typewriter__cursor`).remove(),$("#gen_btn_"+l).remove(),chatVar.isAnswering=!1,$(document).scrollTo("#serverResponse"+serverResponseCnt,{duration:1e3}),e(a)})):s("appendFlag is false")})}else serverResponseCnt++,$(".chatListUl").append(`
                <li class="severAnswer"><b><img src="/resource/mbuster/codingsepo/images/mbusterLogo/logo_chat_icon.png" alt="MBUSTER"></b>
                            <p id="serverResponse${serverResponseCnt}"></p></li>
                `),$(document).scrollTo("#serverResponse"+serverResponseCnt,{duration:1e3});l=serverResponseCnt,i=r.split("<script>"),showMsg=i[0],chatVar.isAnswering=!0,new Typewriter("#serverResponse"+l,{delay:55}).typeString(showMsg).pauseFor(50).start().callFunction(()=>{var e;console.log("종료",l),$(`#serverResponse${l} .Typewriter__cursor`).remove(),$("#gen_btn_"+l).remove(),chatVar.isAnswering=!1,a&&(null!==c&&void 0!==c?(e=a.replaceAll("onclick","disabled_onclick"),$("#serverResponse"+l).append('<hr><span style="color:red;">※아래 버튼을 눌러 새탭 열기를 해보세요!</span><br/>'+e),(e=c).serverResponseCnt=l,e="<br/><button class='button-ai-black' onclick='combineQuery("+JSON.stringify(e)+");'>선택 내용 새탭열기</button><br/>",$("#serverResponse"+l).append(e),$(`#serverResponse${l} .button-combine`).on("click",function(){$(this).toggleClass("combine")})):$("#serverResponse"+l).append("<hr>"+a))}),u="<script>"+i[1],console.log(u,i[1]),i[1]&&$("#serverResponse"+serverResponseCnt).append(u)}$(".chatListUl").scrollTop($(".chatListUl")[0].scrollHeight)}function stopChat(s){if(chatVar.isAnswering){chatVar.chatXhr&&(console.error("답변을 취소합니다."),chatVar.chatXhr.abort(),chatVar.chatXhr=null),chatVar.isAnswering=!1,toastr.info("답변을 종료합니다.");let e=$(s).parent().children()[0].id;e=e.replaceAll("serverResponse","");var r=$(`#serverResponse${e} .Typewriter__wrapper`).html();new Typewriter("#serverResponse"+e,{delay:75}).deleteAll().stop();$(`#serverResponse${e} .Typewriter__wrapper`).html(r),$(`#serverResponse${e} .Typewriter__wrapper`).parent().append('<span style="font-size:10px !important; color:black;">&nbsp;(답변이 취소되었습니다.)</span>'),$(`#serverResponse${e} .Typewriter__cursor`).remove(),$(s).remove()}}function chatErr(e,s){chatVar.isAnswering=!1;var e=e||"에러발생",r=$(".chat_cont ul").children().length-1;s&&-1<r?$(".chat_cont ul").children()[r].innerHTML=`<li class="errorChat"><b><img src="/resource/mbuster/codingsepo/images/mbusterLogo/logo_chat_icon.png" alt="MBUSTER"></b>
        <p style="color: #db4444;">${e}</p></li>`:$(".chat_cont ul").append(`
        <li class="errorChat"><b><img src="/resource/mbuster/codingsepo/images/mbusterLogo/logo_chat_icon.png" alt="MBUSTER"></b>
                    <p style="color: #db4444;">${e}</p></li>
        `),$(".chatListUl").scrollTop($(".chatListUl")[0].scrollHeight)}function insertChatDB(e,s,r){var t={GPT:0,STD:1,SRCH:2,FN:3};r=r||t.SRCH,-1===Object.values(t).indexOf(r)&&(console.error("Invalid value for t: "+r),r=t.SRCH),$.ajax({type:"POST",url:"./insertChatDB.do",async:!1,data:{query:e,answer:s,rcmdtn_type:r},success:function(e){e=e.srch_mng_sn;e<0?console.error("insert 실패"):console.log("qId : "+e)},error:function(e){console.error(e)}})}function syncSignal(){$.ajax({type:"POST",url:"./sync_chatCorpus.do",async:!1,success:function(e){e.flag&&console.log("동기화 완료")},error:function(e){console.error(e)}})}function resetTokens(e){$.ajax({type:"POST",url:"./change_Query.do",async:!1,data:{action:e||null},success:function(e){0<=(e.flag||-1)&&console.log("토큰 재구성 완료")},error:function(e){console.error(e)}})}function getFunctions(e,r){return new Promise((m,s)=>{$.ajax({type:"POST",url:"./getFunctions.do",data:{qId:e,query:r},success:function(e){console.log("getFunctions",e);var s,{relateList:r,fnList:t}=e;let n="";for(s in r){var a=r[s]["query"];n+=`<button class="button-ai">${a}</button> `}n+=r&&0<r.length?"<br>":"";if(t){var o,c,l=[],i=[];for(o in t){var u,p=t[o].split("@"),d={fnName:p[0],qId:p[1],qstn:p[2]};l.includes(p[0])||(l.push(p[0]),p=`<button class="button-ai" fnName="${p[0]}">${d.qstn}</button> `,(u={})[d.qstn]=p,i.push(u))}for(c in i.sort(function(e,s){e=Object.keys(e)[0],s=Object.keys(s)[0];return e.localeCompare(s)}),i){var h=Object.values(i[c])[0];n+=h}}m(n)},error:function(e){console.error(e),s(e)}})})}function wordTest(e){$.ajax({type:"POST",url:"./wordAnalyze.do",data:{query:e},success:function(e){},error:function(e){console.error(e)}})}function loadChatFromHistory(e,t){return new Promise((s,r)=>{$.ajax({type:"POST",url:"./loadChatFromHistory.do",data:{qId:e,query:t},success:function(e){chat({msgFrom:"client",msg:t}),e=e.chat_result;chatVar.lastQuery=t,chatVar.lastTokens=e?.tokens||[],chat_response(e),s()},error:function(e){console.error(e),r(e)}})})}function selectChatHistory(e){var s=e;console.log("채팅 히스토리 내역 출력"+e),$.ajax({type:"POST",url:"selectChatHistory",data:{srch_mng_grp_sn:s},success:async function(e){for(var s in e){var{srch_mng_sn:s,srch_qstn:r}=e[s];await loadChatFromHistory(s,r)}},error:function(e){console.error(e)}})}function getSelectFilter(e){var s,r,t={};for(s in e)s.includes("selectFilter_")&&(r=e[s],t[s]=r.replaceAll("@",""));return t}function getDatesParams(s){var r,t={};for(r in s)if(r.includes("_date")){let e={};var n=s[r],a=r.replace("_date","");e.word=n,e.date="YYYYMMDD",e=parseDate(e),t[a]=e}return t}function parseDate(e){var s={day:/^(오늘)$/i,"day-1":/^(어제)$/i,"day-2":/^(그제)$/i,"day+1":/^(내일)$/i,"day+2":/^(모레)$/i,dayAgo:/\d+일전/,dayAfter:/\d+일후/,weekAgo:/\d+주전/,weekAfter:/\d+주후/,"week-1":/^(저번주|지난주|일주일전)$/i,"week+1":/^(다음주|일주일후)$/i,"month-1":/^(한달전|지난달|저번달)$/i,"month+1":/^(한달후|다음달)$/i,monthAgo:/\d+달전/,monthAfter:/\d+달후/,year:/^(올해)$/i,"year-1":/^(작년|지난해|전년도)$/i,"year+1":/^(내년|다음해)$/i};let{word:r,date:t}=e,n=r.replaceAll(" ","");n=(n=n.replaceAll("부터","")).replaceAll("까지","");var a,o=new Date;let c="";for(a in s)if(s[a].test(n)){c=a;break}let l=0;c.includes("Ago")||c.includes("-")?l=-1:(c.includes("After")||c.includes("+"))&&(l=1);let i,u=0;switch(u=c.includes("Ago")||c.includes("After")?parseInt(n.match(/\d+/)):parseInt(c.match(/\d+/)),u=isNaN(u)?0:u,!0){case c.includes("day"):i=new Date(o.setDate(o.getDate()+l*u));break;case c.includes("week"):i=new Date(o.getTime()+l*u*6048e5);break;case c.includes("month"):i=new Date(o.setMonth(o.getMonth()+l*u));break;case c.includes("year"):i=new Date(o.setYear(o.getYear()+l*u))}return c.includes("yyyy")&&c.includes("mm")&&c.includes("dd")?t=n.replaceAll("-","").replaceAll("/",""):t=i.yyyymmdd(),{word:r,date:t}}function compressDateParams(e){var s,r,t=["from","before","after","singlePoint"],n=["to","before","after","singlePoint"],a={};for(s in t){const l=t[s];var o=Object.keys(e);if(o.some(e=>e.includes(l))){console.log(`'${l}' exists in paramKeys`);o=o.find(e=>e.includes(l));a.from=e[o];break}}for(r in n){const i=n[r];var c=Object.keys(e);if(c.some(e=>e.includes(i))){console.log(`'${i}' exists in paramKeys`);c=c.find(e=>e.includes(i));a.to=e[c];break}}return a}function getSearchDate(e){e=compressDateParams(e);return console.log(e),e}let iframeResponseCount=0;function iframeChatLoad(e,s){if(iframeResponseCount++,console.log(s),"accessLog"===e)console.log(e),chat("server",`<div id="accessLogDiv${iframeResponseCount}">접속자 리스트를 보여드리겠습니다.</div>`),$("#accessLogDiv"+iframeResponseCount).parent().parent().parent().append(`<div class="tbl_wrap scroll" id="accessLogList${iframeResponseCount}" ></div>`),selectAccessLogList(iframeResponseCount,s);else if(e.includes("domainList")){s=e.replaceAll("domainList_","");switch(console.log(s),s){case"show":chat("server",`<div id="domainListDiv${iframeResponseCount}"></div>`),$("#domainListDiv"+iframeResponseCount).parent().parent().parent().append(`<div class="tbl_wrap scroll" id="domainList${iframeResponseCount}" ></div>`),selectDomainList(iframeResponseCount);case"inst":domainInstModalOpen()}}}function askAssist(){alert("현재 미구현된 기능입니다. 이 곳에 기술지원 관련 함수 구현하면 됩니다.")}function getDomainParamList(e){var s,r,t,n=[],a=[],o=[];for(s in e)s.includes("getDomain")&&(r=e[s],o.push(r));for(t in o){var{sys_group_nm:c,dmn_sn:l}=JSON.parse(o[t]);n.push(c),a.push(l)}return 0==n.length?null:{dmn_nm_list:n,dmn_sn_list:a}}function getDateWord(e,s){let r="";s=s?.searchDate_v2||null;if(s){const{search_from:t={},search_to:n={}}=JSON.parse(s);if(!(null!=t&&"{}"!=JSON.stringify(t)||null!=n&&"{}"!=JSON.stringify(n)))return{msg_prev:"금일기준의",msg_after:"'xxxx년xx월xx일부터 xxxx년xx월xx일까지' 처럼 조회를 원하는 날짜를 넣어 검색해보세요."};new Date(t.date),new Date(n.date);if(t.date>n.date){let e="";return null!=t&&(e+=`${t.word}(<span style="color:red">${t.date}</span>) `),null!=n?e+=`${n.word}(<span style="color:red">${n.date}</span>)`:""!=e&&(e+="오늘까지의"),{msg_prev:`잘못된 날짜 기준을 입력했습니다.<br>
            "${e=e.trim()}"는 조회 기준 날짜로 사용할 수 없습니다.<br>
            조회를 원하시는 기간은 반드시 오름차순으로 입력해주세요<br>
            <br>
            금일기준의`,msg_after:"'xxxx년xx월xx일부터 xxxx년xx월xx일까지' 처럼 조회를 원하는 날짜를 넣어 검색해보세요."}}return t.date==n.date?{msg_prev:r=`${t.word}(${t.date})기준 날짜의`,msg_after:""}:t.word==n.word?{msg_prev:r=`${t.word}(${t.date} ~ ${n.date}) 기준 날짜의`,msg_after:""}:(null!=t&&(r+=`${t.word}(${t.date}) `),null!=n?r+=`${n.word}(${n.date})`:""!=r&&(r+="오늘까지의"),r=r.trim(),{msg_prev:r+="<br>기준 날짜의",msg_after:""})}const{search_from:t,search_to:n}=e;return null==t&&null==n?{msg_prev:"금일기준의",msg_after:"'xxxx년xx월xx일부터 xxxx년xx월xx일까지' 처럼 조회를 원하는 날짜를 넣어 검색해보세요."}:{msg_prev:r=t==n?t+" 기준 날짜의":r,msg_after:""}}